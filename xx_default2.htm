<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Is it raining now?</title>
<meta name="robots" content="all" />
<meta name="description" content="I work in an office with no windows and I have no idea what the weather is like now.  Tell me if it is raining outside, because I'm too lazy to go check.  Darn, did I remember my umbrella today?" />
<meta name="keywords" content="weather, rain, raining, yes/no, simple, is it raining?, microsite, umbrella, is it raining now?, is it raining outside?, is it raining here?, weather radar, weather online, bbc weather, uk weather, weather in uk, whether, the wather, the weather chanel, weather condition, buy umbrella, rain umbrella, local weather, microsites, weather channel, weather eye, weather.com, weather forecast" />
<meta name="google-site-verification" content="bg8jFefCWB2ij-CGpxt0zdtveyoe3VlK3OMFfxaHrJ0" />

<script src="_js/jquery-1.3.1.min.js" type="text/javascript"></script>
<script src="http://www.google.com/jsapi?key=ABQIAAAAVyyYTr82STfr73jnFsmqZRRwk7DSKkSrSKlVqeyfVGy-6DIdZxQn4RtXVoPJT1nd9r770KO36Ob7DA" type="text/javascript"></script>
<script src="http://j.maxmind.com/app/geoip.js" type="text/javascript"></script>


<script type="text/javascript">
   //   google.load("maps", "2");
   //   google.load("search", "1");
  //    google.load("jquery", "1.3.2");
	  
	  function initialize() {
		// Initialize default values
		var location = "Not sure";
        var rainResult = "Not sure";
		var urlLocation = "fun";
		
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(displayGeoLocation, errorMessage);
		}
		else {
			getIPlocation();	
		}

	  }
	  
	  // Success! Set a marker on the Google map to show the user's location
		function displayGeoLocation(position) {
			var geoCoords = new GLatLng(position.coords.latitude, position.coords.longitude);
			map.addOverlay(new GMarker(geoCoords));
		}
	  
	  // Boo! Couldn't obtain the user's location. Translate the error code into something useful and inform the user.		
		function errorMessage(error) {
			var errors = { 
				1: 'Permission denied',
				2: 'Position unavailable',
				3: 'Request timeout'
			};
			alert("Error: " + errors[error.code]);
			getIPlocation();	
		}
	  
	  function getIPlocation() {
			// If ClientLocation was filled in by the loader, use that info instead
			if (google.loader.ClientLocation) {
				alert("Showing IP-based location (Google)");
			  userLocation = "<strong>" + getFormattedLocation() + "</strong>";
			} 
			// Else If GeoIP was filled in by the loader, use that info instead
			else if (geoip_country_code()) {
				alert("Showing IP-based location (Geo IP)");
			  userLocation = "<strong>" + getFormattedLocation_GeoIP() + "</strong>";
			}
			
			document.getElementById("userLocation").innerHTML = userLocation;
			//document.getElementById("urllocation").innerHTML = urlLocation;
		}
	
	  function getFormattedLocation() {
		if (google.loader.ClientLocation.address.country_code == "US" &&
		  google.loader.ClientLocation.address.region) {
		  getRainData(google.loader.ClientLocation.address.city + "," 
			  + google.loader.ClientLocation.address.region.toUpperCase());
		  return google.loader.ClientLocation.address.city + ", " 
			  + google.loader.ClientLocation.address.region.toUpperCase();
		} else {
		  getRainData(google.loader.ClientLocation.address.city + ","
			  + google.loader.ClientLocation.address.country_code)
		  return  google.loader.ClientLocation.address.city + ", "
			  + google.loader.ClientLocation.address.country_code;
		}
	  }
	  
	  function getFormattedLocation_GeoIP() {
		if (geoip_country_code() == "US" &&
		  geoip_region()) {
		  getRainData(geoip_city() + "," 
			  + geoip_region().toUpperCase());
		  return geoip_city() + ", " 
			  + geoip_region().toUpperCase();
		} else {
		  getRainData(geoip_city() + ","
			  + geoip_country_code());
		  return  geoip_city() + ", "
			  + geoip_country_code();
		}
	  }

      function getRainData(urlLocation) {
	  		//for testing purposes
	  		//urlLocation = "Redwood Falls,MN";
			
          $.ajax({
            type: "GET",
            //url: "http://www.google.com/ig/api?weather=Washington,DC",
			//url: "test/weather.xml",
			url: "http://www.isitrainingnow.com/proxy/?weather="+urlLocation,
            dataType: "xml",
            success: function(xml) {
                $(xml).find('current_conditions').each(function(){
                    var condition = $(this).find('condition').attr("data");
					isRaining = parseCondition(condition);
					if (isRaining == "Yes") {
                    	$('<div id="answer-yes"></div>').html(isRaining).appendTo('#answer_wrap');
					}
					else {
						$('<div id="answer-no"></div>').html(isRaining).appendTo('#answer_wrap');
					}
					$('<div id="condition"></div>').html(condition).appendTo('#answer_wrap');
					//$('<div id="locationURL"></div>').html(urlLocation).appendTo('#answer_wrap');
                });
            }
        });    
      }

      function parseCondition(condition) {
          if (condition == "Rain" || condition == "Light rain" || condition == "Heavy rain" || condition == "Showers" || condition == "Drizzle" || condition == "Heavy Rain") {
		  	return "Yes";
		  }
		  else {
          	return "No";
		  }
      }

	 $(document).ready(function(){
        google.setOnLoadCallback(initialize);
     });
</script>


<style type="text/css" media="screen">
body {
	font-family:Arial, Helvetica, sans-serif;
	margin:0;
	padding:0;
}

#container {
	padding-top: 150px;
	margin: 0 auto; 
	width: 1000px; 
	text-align:center;
}

#userLocation {
	font-size:24px;
}

#location-map {
	margin:0 auto;
}

#answer-yes, #answer-no {
	font-size:300px;
}

#answer-yes {
	color:#FF0000;
}
	
#answer-no {
	color:#00FF00;
}

#condition {
	font-size:14px;
	font-style:italic;
}
</style>
</head>

<body>

<div id="container">
    <div id="userLocation"></div>
    <div id="urllocation"></div>
    <div id="update">
        <form>
        
        </form>
    </div>
    <div id="answer_wrap"></div>
    
    <div style="text-align:center; padding-top: 20px;"> 
    	<!-- AddThis Button BEGIN -->
        <a class="addthis_button" href="http://www.addthis.com/bookmark.php?v=250&amp;pub=ewilfong"><img src="http://s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a><script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pub=ewilfong"></script>
        <!-- AddThis Button END -->
    </div>

    <div style="text-align:center; padding-top: 100px;"> 
    	<script type="text/javascript"><!--
		google_ad_client = "pub-0621539625535130";
		/* 728x90, created 10/26/09 */
		google_ad_slot = "0434156802";
		google_ad_width = 728;
		google_ad_height = 90;
		//-->
		</script>
		<script type="text/javascript"
		src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
		</script>
    </div>
    <div style="text-align:center; padding-top: 50px;"> 
        <script type="text/javascript"><!--
        google_ad_client = "pub-0621539625535130";
        /* 468x15, created 10/26/09 */
        google_ad_slot = "3547357971";
        google_ad_width = 468;
        google_ad_height = 15;
        //-->
        </script>
        <script type="text/javascript"
        src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
        </script>
    </div>
</div>


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-11185447-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
